# Sistema RMM - Remote Monitoring and Management

## üìã √çndice
- [Vis√£o Geral](#vis√£o-geral)
- [Arquitetura do Sistema](#arquitetura-do-sistema)
- [Pr√©-requisitos](#pr√©-requisitos)
- [Instala√ß√£o e Configura√ß√£o](#instala√ß√£o-e-configura√ß√£o)
- [Configura√ß√£o do MongoDB](#configura√ß√£o-do-mongodb)
- [Uso da Aplica√ß√£o](#uso-da-aplica√ß√£o)
- [Funcionalidades](#funcionalidades)
- [Configura√ß√µes Avan√ßadas](#configura√ß√µes-avan√ßadas)
- [Troubleshooting](#troubleshooting)
- [API Endpoints](#api-endpoints)

## üéØ Vis√£o Geral

O Sistema RMM √© uma solu√ß√£o completa de monitoramento remoto que permite:
- Monitoramento em tempo real de m√°quinas da rede
- Coleta de m√©tricas de hardware (CPU, RAM, GPU, Disco)
- Detec√ß√£o autom√°tica de anomalias
- Interface web responsiva para visualiza√ß√£o
- Sistema de relat√≥rios e alertas
- Hist√≥rico de ocorr√™ncias

## üèóÔ∏è Arquitetura do Sistema

```
‚îú‚îÄ‚îÄ RMM-API/              # Backend Node.js
‚îú‚îÄ‚îÄ RMM-FRONTEND/         # Frontend React Native/Expo
‚îú‚îÄ‚îÄ RMM-MONITOR/          # Servi√ßo de monitoramento
‚îú‚îÄ‚îÄ config.json           # Configura√ß√£o global
‚îî‚îÄ‚îÄ docker-compose.yml    # Orquestra√ß√£o dos containers
```

### Componentes:
- **RMM-API**: API REST que gerencia dados e relat√≥rios
- **RMM-FRONTEND**: Interface web para visualiza√ß√£o
- **RMM-MONITOR**: Agente de monitoramento autom√°tico
- **MongoDB**: Banco de dados (opcional, usando arquivos JSON por padr√£o)

## üîß Pr√©-requisitos

### Software Necess√°rio:
- **Node.js** >= 20.x
- **Docker** e **Docker Compose**
- **MongoDB** (opcional)
- **Git**

### Sistemas Operacionais Suportados:
- Windows 10/11
- Linux (Ubuntu, Debian, CentOS)
- macOS

## üöÄ Instala√ß√£o e Configura√ß√£o

### 1. Clone o Reposit√≥rio
```bash
git clone https://github.com/piegosalles10kk/RMM-OFFLINE
cd RMM-OFFLINE
```

### 2. Configura√ß√£o Inicial

#### Edite o arquivo `config.json`:
```json
{
  "SHARED_NETWORK_PATH": "./BancoDeDados",
  "COLLECTION_INTERVAL_SECONDS": 10,
  "MACHINE_ALIAS": "TI",
  "LOCAL": true,
  "API": false,
  "APIURL": ""
}
```

**Par√¢metros:**
- `SHARED_NETWORK_PATH`: Caminho onde os dados ser√£o armazenados
- `COLLECTION_INTERVAL_SECONDS`: Intervalo de coleta em segundos
- `MACHINE_ALIAS`: Alias da m√°quina atual
- `LOCAL`: true para armazenamento local, false para usar API
- `API`: true para utilizar o mongo
- `APIURL`: URL da api node http://localhost:2500

### 3. Usando Docker (Recomendado)

```bash
# Construir e executar os containers
docker-compose up --build

# Executar em segundo plano
docker-compose up -d
```

**Portas:**
- Frontend: http://localhost:8081
- API: http://localhost:2500

### 4. Instala√ß√£o Manual

#### Backend (RMM-API):
```bash
cd RMM-API
npm install
npm start
```

#### Frontend (RMM-FRONTEND):
```bash
cd RMM-FRONTEND
npm install
npx expo start --web
```

#### Monitor:
```bash
cd RMM-MONITOR
npm install
```

## üçÉ Configura√ß√£o do MongoDB

### 1. Instala√ß√£o do MongoDB

#### Windows:
```bash
# Download do MongoDB Community Server
# https://www.mongodb.com/try/download/community
```

#### Linux (Ubuntu/Debian):
```bash
sudo apt update
sudo apt install -y mongodb-org
sudo systemctl start mongod
sudo systemctl enable mongod
```

#### Docker:
```bash
docker run -d --name mongodb -p 27017:27017 mongo:latest
```

### 2. Configura√ß√£o da Conex√£o

O arquivo `RMM-API/services/mongoService.js` j√° est√° configurado para conectar em:
```javascript
mongodb://localhost:27017/MonitorAgente
```

### 3. Habilitando o MongoDB na API

Para usar as rotas que utilizam MongoDB, acesse os endpoints com prefixo `/monitoramento/mongo/`:

```javascript
// Exemplos de endpoints MongoDB
GET    /monitoramento/mongo/aliases
POST   /monitoramento/mongo/registro
GET    /monitoramento/mongo/:machine_alias
GET    /monitoramento/mongo/relatorios
GET    /monitoramento/mongo/relatorios/:mesAno
POST   /monitoramento/mongo/log-ocorrencia
```

### 4. Estrutura das Collections

#### `dadosmensals` - Dados de monitoramento agrupados por m√™s:
```json
{
  "_id": "ObjectId",
  "mes_referencia": "2025-01",
  "maquinas": {
    "MACHINE_NAME": [
      {
        "timestamp_coleta": "24/01/2025 14:30:00",
        "machine_alias": "MACHINE_NAME",
        "monitoramento": {
          "cpu": {...},
          "memoria_ram": {...},
          "gpu": {...}
        }
      }
    ]
  }
}
```

#### `relatorios` - Hist√≥rico de chamados/ocorr√™ncias:
```json
{
  "_id": "ObjectId",
  "maquina": "MACHINE_NAME",
  "ocorrencia": {
    "CPU Temp": "85¬∞C",
    "RAM Uso": "90%"
  },
  "horario": "2025-01-24T14:30:00.000Z"
}
```

## üíª Uso da Aplica√ß√£o

### 1. Acesso ao Frontend
Acesse `http://localhost:8081` no navegador

### 2. Interface Principal

#### Dashboard (Home)
- Visualiza gr√°ficos de ocorr√™ncias por m√™s, tipo e m√°quina
- Filtros por per√≠odo
- Gera√ß√£o de relat√≥rios mensais

#### Visualiza√ß√£o de M√°quinas (View)
- Cards em tempo real das m√°quinas monitoradas
- M√©tricas de CPU, RAM, GPU, Disco
- Gr√°ficos hist√≥ricos
- Status de conectividade (Online/Offline)

#### Log de Ocorr√™ncias
- Busca por ocorr√™ncias espec√≠ficas
- Filtros por m√°quina, data e tipo
- Visualiza√ß√£o detalhada do JSON de dados
- Hist√≥rico de processos

#### Sistema de Chamados
- Abertura de chamados via email
- Formul√°rio integrado
- Categoriza√ß√£o autom√°tica

### 3. Monitoramento Autom√°tico

Execute o monitoramento manual:
```bash
# Windows
verificarMaquinas.bat

# Linux/Mac
cd RMM-MONITOR
node monitoramento.js
```

## üî• Funcionalidades

### Monitoramento em Tempo Real
- **CPU**: Temperatura e uso percentual
- **RAM**: Uso e capacidade total
- **GPU**: Temperatura e uso
- **Disco**: Espa√ßo utilizado
- **Uptime**: Tempo de atividade da m√°quina

### Detec√ß√£o de Anomalias
- **CPU Temp** > 70¬∞C
- **CPU Uso** > 80%
- **RAM Uso** > 80%
- **Disco Uso** > 90%
- **GPU Uso** > 80%
- **GPU Temp** > 80¬∞C
- **Offline**: M√°quina sem resposta

### Sistema de Relat√≥rios
- Relat√≥rios mensais em PDF
- Gr√°ficos interativos
- Hist√≥rico de ocorr√™ncias
- Filtros avan√ßados

### Alertas e Notifica√ß√µes
- Detec√ß√£o autom√°tica de novas anomalias
- Sistema de exce√ß√µes configur√°vel
- Hist√≥rico persistente

## ‚öôÔ∏è Configura√ß√µes Avan√ßadas

### 1. Configura√ß√£o de Timeout Offline

Para ajustar o tempo que uma m√°quina √© considerada offline, edite o arquivo `RMM-MONITOR/monitoramento.js`:

```javascript
// Linha ~90
const TEMPO_OFFLINE = machine_alias === "AGILENT" ? 3 * UMA_HORA : UMA_HORA;
```

**Op√ß√µes de configura√ß√£o:**
```javascript
// 30 minutos
const TEMPO_OFFLINE = 30 * 60 * 1000;

// 2 horas
const TEMPO_OFFLINE = 2 * 60 * 60 * 1000;

// Por m√°quina espec√≠fica
const temposPorMaquina = {
  "SERVIDOR": 2 * UMA_HORA,
  "DESKTOP01": 30 * 60 * 1000,
  "AGILENT": 3 * UMA_HORA
};
const TEMPO_OFFLINE = temposPorMaquina[machine_alias] || UMA_HORA;
```

### 2. Configura√ß√£o de Exce√ß√µes

Crie o arquivo `BancoDeDados/ignorar_maquinas.json`:
```json
{
  "MACHINE_NAME": ["CPU Temp", "GPU Uso"],
  "SERVIDOR": "RAM Uso",
  "DESKTOP01": ["Offline desde"]
}
```

### 3. Configura√ß√£o de Limites de Anomalia

Edite `RMM-MONITOR/monitoramento.js` nas linhas ~60-70:
```javascript
if (cpu.temperatura_package_celsius > 75) // Era 70
if (cpu.percentual_uso > 85) // Era 80
if (ram.percentual_uso > 85) // Era 80
if (disco.percentual_uso > 95) // Era 90
if (gpu.uso_percentual > 85) // Era 80
if (gpu.temperatura_core_celsius > 85) // Era 80
```

### 4. Configura√ß√£o do Frontend

#### Mudan√ßa de URL da API
Edite `RMM-FRONTEND/servicos/api.ts`:
```typescript
const link = 'http://SEU_SERVIDOR:2500'
```

#### Configura√ß√£o do Sistema de Chamados
Edite `RMM-FRONTEND/tabs/Chamados.tsx`:
```javascript
const api = "http://SEU_SERVIDOR:1000";
//const data = { ...formData, to: "diegosalles@live.com" };
const data = { ...formData, to: "seuemail@empresa.com" };
```

## üîç API Endpoints

### Endpoints de Arquivo (Padr√£o)
```
GET    /dados/maquinas              # Lista todas as m√°quinas
GET    /:machine_alias              # Dados de uma m√°quina
GET    /relatorio                   # Relat√≥rio completo
GET    /relatorio/:maquina          # Relat√≥rio por m√°quina
GET    /relatorio/mes/:mesAno       # Relat√≥rio por per√≠odo
POST   /dados/log                   # Busca log espec√≠fico
```

### Endpoints MongoDB
```
POST   /monitoramento/mongo/registro           # Registra dados
GET    /monitoramento/mongo/aliases            # Lista m√°quinas
GET    /monitoramento/mongo/:machine_alias     # Dados por m√°quina
GET    /monitoramento/mongo/relatorios         # Todos os relat√≥rios
GET    /monitoramento/mongo/relatorios/:mesAno # Relat√≥rio por per√≠odo
POST   /monitoramento/mongo/log-ocorrencia     # Busca log espec√≠fico
```

### Exemplos de Uso da API

#### Buscar dados de uma m√°quina:
```bash
curl http://localhost:2500/MACHINE_NAME
```

#### Buscar log espec√≠fico:
```bash
curl -X POST http://localhost:2500/dados/log \
  -H "Content-Type: application/json" \
  -d '{
    "machine_alias": "DESKTOP01",
    "dataOcorencia": "24/01/2025",
    "tipoDeOcorrencia": "temperatura_package_celsius: 75"
  }'
```

#### Registrar dados no MongoDB:
```bash
curl -X POST http://localhost:2500/monitoramento/mongo/registro \
  -H "Content-Type: application/json" \
  -d '{
    "timestamp_coleta": "24/01/2025 14:30:00",
    "machine_alias": "DESKTOP01",
    "monitoramento": {
      "cpu": {
        "temperatura_package_celsius": 65,
        "percentual_uso": 45
      }
    }
  }'
```

## üõ†Ô∏è Troubleshooting

### Problemas Comuns

#### 1. Frontend n√£o conecta com API
```bash
# Verificar se a API est√° rodando
curl http://localhost:2500/dados/maquinas

# Verificar logs do container
docker logs rmm-api
```

#### 2. MongoDB n√£o conecta
```bash
# Verificar se MongoDB est√° rodando
sudo systemctl status mongod

# Testar conex√£o
mongo --host localhost --port 27017
```

#### 3. M√°quinas n√£o aparecem
- Verificar se os agentes est√£o enviando dados
- Conferir o arquivo `config.json`
- Verificar permiss√µes da pasta `BancoDeDados`

#### 4. Dados n√£o atualizando
- Executar o monitoramento manualmente: `node monitoramento.js`
- Verificar logs no console
- Conferir conectividade de rede

### Logs e Debug

#### Habilitar logs detalhados:
```bash
# API
DEBUG=* npm start

# Monitor
node monitoramento.js > monitor.log 2>&1
```

#### Verificar estrutura de dados:
```bash
# Listar arquivos de dados
ls -la BancoDeDados/

# Verificar formato JSON
cat BancoDeDados/2025-01/MACHINE_NAME.json | jq .
```

## üìÅ Estrutura de Arquivos de Dados

### Armazenamento por Arquivo (Padr√£o)
```
BancoDeDados/
‚îú‚îÄ‚îÄ 2025-01/
‚îÇ   ‚îú‚îÄ‚îÄ MACHINE1.json
‚îÇ   ‚îú‚îÄ‚îÄ MACHINE2.json
‚îÇ   ‚îî‚îÄ‚îÄ dados_gerais_mensal.json
‚îú‚îÄ‚îÄ relat√≥rios/
‚îÇ   ‚îî‚îÄ‚îÄ historico-de-chamados.json
‚îú‚îÄ‚îÄ ocorrencias.json
‚îú‚îÄ‚îÄ novas_ocorrencias.json
‚îî‚îÄ‚îÄ ignorar_maquinas.json
```

### Exemplo de arquivo de m√°quina:
```json
[
  {
    "timestamp_coleta": "24/01/2025 14:30:00",
    "machine_alias": "DESKTOP01",
    "hostname": "DESKTOP01-PC",
    "monitoramento": {
      "cpu": {
        "nome": "Intel Core i7-9700K",
        "temperatura_package_celsius": 65,
        "percentual_uso": 45
      },
      "memoria_ram": {
        "total_gb": 16,
        "usado_gb": 8.5,
        "percentual_uso": 53
      },
      "gpu": {
        "nome": "NVIDIA GTX 1660",
        "temperatura_core_celsius": 55,
        "uso_percentual": 25
      },
      "disco_principal": {
        "total_gb": 500,
        "usado_gb": 250,
        "percentual_uso": 50
      },
      "uptime_horas": 48,
      "top_processos": {
        "top_cpu_processes": [...],
        "top_ram_processes": [...]
      }
    }
  }
]
```

## üîÑ Automa√ß√£o e Agendamento

### Windows - Task Scheduler
```batch
# Criar tarefa que executa a cada 5 minutos
schtasks /create /tn "RMM Monitor" /tr "C:\path\to\verificarMaquinas.bat" /sc minute /mo 5
```

### Linux - Cron
```bash
# Adicionar ao crontab
crontab -e

# Executar a cada 5 minutos
*/5 * * * * cd /path/to/RMM-MONITOR && node monitoramento.js
```

### Systemd Service (Linux)
```ini
# /etc/systemd/system/rmm-monitor.service
[Unit]
Description=RMM Monitor Service
After=network.target

[Service]
Type=simple
User=rmm
WorkingDirectory=/path/to/RMM-MONITOR
ExecStart=/usr/bin/node monitoramento.js
Restart=always
RestartSec=300

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable rmm-monitor.service
sudo systemctl start rmm-monitor.service
```

## üìä Monitoramento de Performance

### M√©tricas do Sistema
- Monitore o uso de CPU/RAM da aplica√ß√£o
- Verifique o crescimento dos arquivos de dados
- Acompanhe os logs de erro

### Otimiza√ß√µes Recomendadas
- Limpar dados antigos periodicamente
- Usar MongoDB para grandes volumes
- Configurar rota√ß√£o de logs
- Implementar backup autom√°tico

## üîê Seguran√ßa

### Recomenda√ß√µes
- Execute a aplica√ß√£o com usu√°rio n√£o-root
- Configure firewall para as portas utilizadas
- Implemente autentica√ß√£o se necess√°rio
- Monitore acessos n√£o autorizados

### Backup
```bash
# Backup dos dados
tar -czf backup-rmm-$(date +%Y%m%d).tar.gz BancoDeDados/

# Backup do MongoDB
mongodump --db MonitorAgente --out backup-mongo-$(date +%Y%m%d)
```

---

**Vers√£o**: 1.0  
**√öltima Atualiza√ß√£o**: Setembro  2025  
